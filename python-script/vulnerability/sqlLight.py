import sqlite3
from typing import List, Dict, Optional

def get_connection(db_path: str = "example.db") -> sqlite3.Connection:
    conn = sqlite3.connect(db_path)
    conn.row_factory = sqlite3.Row  # retorna linhas como dict-like
    return conn

def create_users_table(db_path: str = "example.db") -> None:
    with get_connection(db_path) as conn:
        conn.execute(
            """
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                username TEXT NOT NULL,
                age INTEGER
            )
            """
        )

def insert_user(db_path: str, username: str, age: Optional[int]) -> int:
    if not isinstance(username, str):
        raise TypeError("username deve ser string")
    if age is not None and not isinstance(age, int):
        raise TypeError("age deve ser int ou None")
    with get_connection(db_path) as conn:
        cur = conn.execute(
            "INSERT INTO users (username, age) VALUES (?, ?)",
            (username, age)
        )
        return cur.lastrowid

def find_users_by_name(db_path: str, username: str) -> List[Dict]:
    if not isinstance(username, str):
        raise TypeError("username deve ser string")
    with get_connection(db_path) as conn:
        cur = conn.execute(
            "SELECT id, username, age FROM users WHERE username = ?",
            (username,)
        )
        return [dict(row) for row in cur.fetchall()]

def search_users_like(db_path: str, term: str) -> List[Dict]:
    # use parâmetros; construa o padrão em Python, não na string SQL
    if not isinstance(term, str):
        raise TypeError("term deve ser string")
    pattern = f"%{term}%"
    with get_connection(db_path) as conn:
        cur = conn.execute(
            "SELECT id, username, age FROM users WHERE username LIKE ?",
            (pattern,)
        )
        return [dict(row) for row in cur.fetchall()]

if __name__ == "__main__":
    DB = "example.db"
    create_users_table(DB)
    insert_user(DB, "alice", 30)
    insert_user(DB, "bob", 25)
    print("Exact 'alice':", find_users_by_name(DB, "alice"))
    print("Search '%bo%':", search_users_like(DB, "bo"))